<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistencia | Clase</title>
</head>
<body>
    <h1>Clases disponibles</h1>
    <h2 id="saludo"></h2>

    <h3>Mis Clases</h3>
    <div id="clases"></div>
    <h3>Direcci√≥n de grupo</h3>
    <div id="direccion"></div>

    <script type="module">
        import {supabase} from './js/supabase.js'

        const {data: {user}} = await supabase.auth.getUser()
        if (!user) {
            window.location.href = 'index.html'
        }

        const {data: perfil} = await supabase
            .from('perfiles_usuarios')
            .select('*')
            .single()
        
        console.log(perfil)
        
        document.getElementById('saludo').textContent = 
            `Hola, ${perfil.nombre} ${perfil.apellido}`

        const {data: clases} = await supabase
            .from('vista_clases_docente')
            .select('*')

        const contClases = document.getElementById('clases')

        if (clases.length === 0) {
            contClases.textContent = 'No tienes clases asignadas'
        } else{
            clases.forEach(c => {
                const div = document.createElement('div')
                div.className = 'card'
                div.innerHTML = `
                  <strong>${c.grupo} - ${c.materia}</strong><br>
                  <button onclick="irAsistencia('${c.dmg_id}')">
                    Tomar asistencia
                  </button>
                `
                contClases.appendChild(div)
            })
        }

        const {data: gruposDir} = await supabase
        .from('grupos')
        .select('id, nombre')
        .eq('director_id', user.id)

        const contDir = document.getElementById('direccion')

        if(gruposDir.length === 0) {
            contDir.textContent = 'No eres director de grupo'
        } else{
            gruposDir.forEach(g =>{
                const div = document.createElement('div')
                div.className = 'card'
                div.innerHTML = `
                  <strong>${g.nombre}</strong><br>
                  <button onclick="irReporte('${g.id}')">
                    Ver reporte general
                  </button>
                `
                contDir.appendChild(div)
            })
        }

        window.irAsistencia = (dmg_id) => {
            window.location.href = `asistencia.html?dmg_id=${dmg_id}`
        }

        window.irReporte = (dmg_id) => {
            alert('Reporte aun no implementado')
        }
    </script>
</body>
</html>