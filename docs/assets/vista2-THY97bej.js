import{s as u}from"./supabase-zSLyDIsJ.js";var c=(e=>(e.Presente="presente",e.Ausente="ausente",e.Tarde="tarde",e.Excusa="excusa",e))(c||{});class _{static next(t){switch(t){case"presente":return"ausente";case"ausente":return"tarde";case"tarde":return"excusa";case"excusa":return"presente"}}}const s={asistencias:new Map},h=new URLSearchParams(window.location.search),m=h.get("dmg_id");let r=null,d=null,p=null,f=null;const g=new Date().toISOString().slice(0,10);document.addEventListener("DOMContentLoaded",E);document.getElementById("allPresent").addEventListener("click",b);document.getElementById("allAbsent").addEventListener("click",v);document.getElementById("saveButton").addEventListener("click",w);async function E(){if(!m){alert("Falta el ID de asignaciÃ³n docente "),location.replace("clases.html");return}const{data:e,error:t}=await u.from("vista_clases_docente").select("grupo_id, materia_id, grupo, materia").eq("dmg_id",m).single();if(t){alert(t.message);return}r=e.grupo_id,d=e.materia_id,p=e.grupo,f=e.materia,r&&(document.getElementById("titulo").innerText=`Asistencia ${g} | Grupo: ${p} - Materia: ${f}`,await y(r),l())}async function y(e){const{data:t,error:a}=await u.from("estudiantes").select("id, nombre, apellido").eq("grupo_id",e).order("apellido",{ascending:!0}).order("nombre",{ascending:!0});if(a){alert(a.message);return}t.forEach(n=>{s.asistencias.set(n.id,{nombre:`${n.apellido} ${n.nombre}`,estado:c.Presente})})}function l(){const e=document.getElementById("lista");e.innerHTML="",s.asistencias.forEach((t,a)=>{const n=document.createElement("div");n.className="fila";const o=document.createElement("span");o.className="nombre",o.textContent=t.nombre;const i=document.createElement("span");i.className=`estado ${t.estado}`,i.textContent=" "+t.estado.toUpperCase(),i.dataset.id=a,n.appendChild(o),n.appendChild(i),e.appendChild(n)}),document.body.style.opacity="1"}document.addEventListener("click",e=>{const t=e.target;if(t&&t.classList.contains("estado")){const a=t.dataset.id;if(!a)return;x(a)}});function b(){s.asistencias.forEach(e=>e.estado=c.Presente),l()}function v(){s.asistencias.forEach(e=>e.estado=c.Ausente),l()}async function w(){if(!r||!d)return;const{error:e}=await u.rpc("guardar_asistencia_mvp",{p_grupo_id:r,p_materia_id:d,p_fecha:g,p_asistencias:C(s.asistencias)});e?alert(e.message):(alert("Asistencia guardada correctamente"),location.replace("clases.html"))}function x(e){const t=s.asistencias.get(e);t&&(t.estado=_.next(t.estado),L(e,t.estado))}function L(e,t){const a=document.querySelector(`[data-id="${e}"]`);a&&(a.className=`estado ${t}`,a.innerText=t.toUpperCase())}function C(e){const t=[];return e.forEach((a,n)=>{t.push({estudiante_id:n,estado:a.estado})}),t}
