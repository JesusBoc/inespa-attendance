import"./index-Q759UxCl.js";import{s as u}from"./supabase-DEVtsQcK.js";var a;(function(e){e.Presente="presente",e.Ausente="ausente",e.Tarde="tarde",e.Excusa="excusa"})(a||(a={}));a.Presente,a.Tarde,a.Ausente,a.Excusa;class E{static next(t){switch(t){case a.Presente:return a.Ausente;case a.Ausente:return a.Tarde;case a.Tarde:return a.Excusa;case a.Excusa:return a.Presente}}}const r={asistencias:new Map},_=new URLSearchParams(window.location.search),m=_.get("dmg_id");let i=null,d=null,p=null,f=null;const g=new Date().toISOString().slice(0,10);document.addEventListener("DOMContentLoaded",h);document.getElementById("allPresent").addEventListener("click",b);document.getElementById("allAbsent").addEventListener("click",x);document.getElementById("saveButton").addEventListener("click",v);async function h(){if(!m){alert("Falta el ID de asignaciÃ³n docente "),location.replace("clases.html");return}const{data:e,error:t}=await u.from("vista_clases_docente").select("grupo_id, materia_id, grupo, materia").eq("dmg_id",m).single();if(t){alert(t.message);return}i=e.grupo_id,d=e.materia_id,p=e.grupo,f=e.materia,i&&(document.getElementById("titulo").innerText=`Asistencia ${g} | Grupo: ${p} - Materia: ${f}`,await y(i),l())}async function y(e){const{data:t,error:n}=await u.from("estudiantes").select("id, nombre, apellido").eq("grupo_id",e).order("apellido",{ascending:!0}).order("nombre",{ascending:!0});if(n){alert(n.message);return}t.forEach(s=>{r.asistencias.set(s.id,{nombre:`${s.apellido} ${s.nombre}`,estado:a.Presente})})}function l(){const e=document.getElementById("lista");e.innerHTML="",r.asistencias.forEach((t,n)=>{const s=document.createElement("div");s.className="fila";const o=document.createElement("span");o.className="nombre",o.textContent=t.nombre;const c=document.createElement("span");c.className=`estado ${t.estado}`,c.textContent=" "+t.estado.toUpperCase(),c.dataset.id=n,s.appendChild(o),s.appendChild(c),e.appendChild(s)}),document.body.style.opacity="1"}document.addEventListener("click",e=>{const t=e.target;if(t&&t.classList.contains("estado")){const n=t.dataset.id;if(!n)return;w(n)}});function b(){r.asistencias.forEach(e=>e.estado=a.Presente),l()}function x(){r.asistencias.forEach(e=>e.estado=a.Ausente),l()}async function v(){if(!i||!d)return;const{error:e}=await u.rpc("guardar_asistencia_mvp",{p_grupo_id:i,p_materia_id:d,p_fecha:g,p_asistencias:L(r.asistencias)});e?alert(e.message):(alert("Asistencia guardada correctamente"),location.replace("clases.html"))}function w(e){const t=r.asistencias.get(e);t&&(t.estado=E.next(t.estado),A(e,t.estado))}function A(e,t){const n=document.querySelector(`[data-id="${e}"]`);n&&(n.className=`estado ${t}`,n.innerText=t.toUpperCase())}function L(e){const t=[];return e.forEach((n,s)=>{t.push({estudiante_id:s,estado:n.estado})}),t}
