import{s as c}from"./supabase-UP22jYpv.js";import{L as g}from"./LogoutButton-BK6TZlWM.js";import{U as b,B as h}from"./UserService-Ch9RJqrP.js";import{V as m}from"./View-uiRyqzUW.js";class C{constructor(e){this.entries=e}overlay;modal;open(e){this.buildDOM(e),this.overlay&&(document.body.appendChild(this.overlay),document.addEventListener("keydown",this.handleEscape))}buildDOM(e){this.overlay=document.createElement("div"),this.overlay.className="modal-overlay",this.modal=document.createElement("div"),this.modal.className="modal",this.renderEntries(this.modal,e),this.overlay.appendChild(this.modal),this.overlay.addEventListener("click",t=>{t.target===this.overlay&&this.close()})}close(){document.removeEventListener("keydown",this.handleEscape),this.overlay?.remove()}handleEscape=e=>{e.key==="Escape"&&this.close()}}class u extends C{renderEntries(e,t){const s=document.createElement("h3");s.innerText="Seleccionar docente";const a=document.createElement("ul");for(const n of this.entries){const i=document.createElement("li");i.innerText=n.name,i.dataset.id=n.id,i.addEventListener("click",()=>{t(n.id),this.close()}),a.appendChild(i)}e.appendChild(s),e.appendChild(a)}}const y=[{id:"03d6c6c0-1c78-4231-ad4d-d4d250f069a1",name:"Procesos lectores"},{id:"067cf860-794f-4834-a681-caab02c7c0d6",name:"Pre Química"},{id:"0da8811a-94cc-4328-a506-f578a967f3a1",name:"Física"},{id:"2415d0c4-adb3-4298-9eec-cc913ff125ad",name:"Tecnología e informática"},{id:"3888da8b-3608-4dc7-9690-29aaffb7e902",name:"Religion"},{id:"49014132-33c7-4186-b98b-71296c6039fc",name:"Química"},{id:"4bb581b6-4091-4b54-af7f-e5fffbdae5e6",name:"Estadística"},{id:"5654d6f8-b3df-4abe-8ef4-81bfce9d36ea",name:"Competencias Ciudadanas"},{id:"5d11cb01-3907-4ad4-af7d-e285a45bd49d",name:"Cátedra Afrocolombiana"},{id:"5fb3e883-57bc-4a1a-9942-e647655331f7",name:"Filosofía"},{id:"7482ea4b-98d1-4d5e-9424-896f1f65c26c",name:"Inglés"},{id:"74ece738-cefa-41ba-8e97-15d66dd3fb72",name:"Geometría"},{id:"7a89db6c-09c0-4028-93b3-bbd600a08282",name:"Ética y Valores"},{id:"7c6441bc-8635-40fe-b200-8b48a4ccf5ac",name:"Ciencias Sociales"},{id:"7c73df5f-b5eb-49cb-bcc4-115ba0d4ef3c",name:"Cátedra de la paz"},{id:"8d1d7259-b839-468d-8b79-fec5898e3094",name:"Matemáticas"},{id:"9126bc10-e836-4669-abcd-e8d1bcbc947d",name:"Lengua Castellana"},{id:"ab5b9ae5-1419-4aca-86f1-7bca9e74f7af",name:"Educación Física"},{id:"d43cc1ff-b2fb-44fe-9826-fa6f6882c818",name:"Artística"},{id:"e16825b7-7ae3-42f0-8f2c-ae8f851ad88f",name:"Biología"},{id:"ef28dfed-75d8-408a-a25e-8f6b36dbe46d",name:"Pre Física"}],N=y.toSorted((r,e)=>r.name.localeCompare(e.name));class E extends b{role="docente";static async create(){const e=new this;return await e.reload(),e}async lookTable(){const{data:e,error:t}=await c.from(this.tableName).select("*").neq("rol","admin").neq("rol","coordinador").eq("activo",!0).order("apellido").order("nombre");return{data:e,error:t}}}class w{constructor(e){this.data=e}setData(e){this.data=e}create(){const e=document.createElement("table");e.className="reportTable";const t=this.createHeader(),s=this.createBody();return e.appendChild(t),e.appendChild(s),e}createHeader(){const e=document.createElement("thead"),t=document.createElement("tr");for(const s of this.headers){const a=document.createElement("th");a.innerText=s,t.appendChild(a)}return e.appendChild(t),e}createBody(){const e=document.createElement("tbody");for(const[t,s]of this.data.entries()){const a=this.rowMapper(t,s);e.appendChild(a)}return e}}class M extends w{headers=["Materia","Profesor"];rowMapper(e,t){const s=document.createElement("tr"),a=document.createElement("td");a.innerText=t.subjectName;const n=document.createElement("td");return n.classList.add("specialCell"),n.dataset.assignmentId=e,t.teacherName?n.innerText=t.teacherName+" "+t.teacherLastName:n.innerText="No asignado",s.dataset.id=e,s.appendChild(a),s.appendChild(n),s}}class S extends m{onTeacherClick;onButtonClick;button;render(e){const t=e.getAssignments(),s=new Map,a=e.getSelectedCourse();if(!a)throw new Error("There is not selected group");t.forEach((o,d)=>{o.groupId===a&&s.set(d,o)});const i=new M(s).create();this.root.appendChild(i)}constructor(e,t,s){super(e,t),this.button=document.createElement("button"),this.button.className="attendanceButton secondary inactivo",this.button.innerText="Agregar asignatura";const a=document.createElement("ul");a.className="mainSelector";for(const n of s){const i=document.createElement("li");i.className="courseSelector",i.innerText=n[1],i.dataset.id=n[0],a.appendChild(i)}this.container?.prepend(a),this.container?.append(this.button),this.root.addEventListener("click",n=>{const i=n.target;if(i.classList.contains("specialCell")){const o=i.dataset.assignmentId;if(!o)return;this.onTeacherClick?.(o)}}),this.button.addEventListener("click",n=>{this.onButtonClick?.()})}showButton(){this.button.className="attendanceButton secondary activo"}hideButton(){this.button.className="attendanceButton secondary inactivo"}getSelectors(){return this.container?.getElementsByClassName("courseSelector")}}class k{constructor(e,t){this.viewModel=e,this.view=new S("assignmentsActions","assignmentsMenu",t),this.bindCourseSelectors(),this.bindModalAction(),this.bindButtonAction()}view;teacherService;bindCourseSelectors(){const e=this.view.getSelectors();if(!(!e||e.length<0))for(const t of e)t.addEventListener("click",()=>{const s=this.viewModel.getSelectedCourse(),a=document.querySelector(`[data-id='${s}']`);a&&a.classList.remove("selected");const n=t.getAttribute("data-id");if(!n)throw new Error(`id: ${n} not found`);if(this.view.clear(),s==n){this.view.hideButton(),this.viewModel.setSelectedCourse(void 0);return}this.viewModel.setSelectedCourse(n),t.classList.add("selected"),this.view.render(this.viewModel),this.view.showButton()})}bindModalAction(){this.view.onTeacherClick=async e=>{await this.openTeacherModal(e)}}bindButtonAction(){this.view.onButtonClick=async()=>{await this.openSubjectsModal()}}show(){this.view.render(this.viewModel)}hide(){this.view.clear()}async update(){await this.viewModel.refreshData()}async openTeacherModal(e){this.teacherService||(this.teacherService=await E.create());const t=this.teacherService.getAll().entries().toArray().map(([a,n])=>({id:a,name:n.name+" "+n.lastName})),s=new u(t);s.open(async a=>{await this.viewModel.assignTeacher(e,a),this.view.clear(),s.close(),this.view.render(this.viewModel)})}async openSubjectsModal(){const e=N,t=this.viewModel.getSelectedCourse();if(!t)return;const s=new u(e);s.open(async a=>{const n=await this.viewModel.createAssignment(t,a);console.log(n),this.view.clear(),s.close(),this.view.render(this.viewModel)})}}class A extends w{headers=["Nombre","Apellido","Acciones"];onDeleteClick;onReassignClick;rowMapper(e,t){const s=document.createElement("tr"),a=document.createElement("td");a.innerText=t.name,a.className="specialCell studentName",a.dataset.studentId=e;const n=document.createElement("td");n.innerText=t.lastName,n.className="specialCell studentLastName",n.dataset.studentId=e;const i=document.createElement("td"),o=document.createElement("button");o.innerText="Borrar",o.addEventListener("click",v=>{this.onDeleteClick&&this.onDeleteClick(e)});const d=document.createElement("button");d.innerText="Reasignar",d.addEventListener("click",v=>{this.onReassignClick&&this.onReassignClick(e)});const l=document.createElement("div");return l.appendChild(o),l.appendChild(d),l.className="actionGroup",i.appendChild(l),s.appendChild(a),s.appendChild(n),s.appendChild(i),s}}class B extends m{onNameClick;onLastNameClick;onButtonClick;onDeleteClick;onReassignClick;button;render(e){const t=e.getStudents(),s=new Map,a=e.getSelectedCourse();if(!a)throw new Error("There is not selected group");t.forEach((o,d)=>{o.groupId===a&&s.set(d,o)});const n=new A(s);if(!this.onDeleteClick)throw new Error("No se ha definido la funcion onDeleteClick");if(n.onDeleteClick=this.onDeleteClick,!this.onReassignClick)throw new Error("No se ha definido la funcion onDeleteClick");n.onReassignClick=this.onReassignClick;const i=n.create();this.root.appendChild(i)}constructor(e,t,s){super(e,t),this.button=document.createElement("button"),this.button.className="attendanceButton secondary inactivo",this.button.innerText="Agregar estudiante";const a=document.createElement("ul");a.className="mainSelector";for(const n of s){const i=document.createElement("li");i.className="courseSelector",i.innerText=n[1],i.dataset.id=n[0],a.appendChild(i)}this.container?.prepend(a),this.container?.append(this.button),this.root.addEventListener("click",n=>{const i=n.target;if(i.classList.contains("studentName")){const o=i.dataset.studentId;if(!o)return;this.onNameClick?.(o)}}),this.root.addEventListener("click",n=>{const i=n.target;if(i.classList.contains("studentLastName")){const o=i.dataset.studentId;if(!o)return;this.onLastNameClick?.(o)}}),this.button.addEventListener("click",n=>{this.onButtonClick?.()})}showButton(){this.button.className="attendanceButton secondary activo"}hideButton(){this.button.className="attendanceButton secondary inactivo"}getSelectors(){return this.container?.getElementsByClassName("courseSelector")}}class I{constructor(e,t){this.viewModel=e,this.groups=t,this.view=new B("studentsActions","studentsMenu",t),this.bindCourseSelectors(),this.bindModalAction(),this.bindButtonAction()}view;bindCourseSelectors(){const e=this.view.getSelectors();if(!(!e||e.length<0))for(const t of e)t.addEventListener("click",()=>{const s=t.getAttribute("data-id");if(!s)throw new Error(`id: ${s} not found`);if(this.view.clear(),this.viewModel.getSelectedCourse()==s){this.view.hideButton(),this.viewModel.setSelectedCourse(void 0);return}this.viewModel.setSelectedCourse(s),this.view.render(this.viewModel),this.view.showButton()})}bindModalAction(){this.view.onNameClick=async e=>{console.log("Estoy por aqui en onNameClick");const t=prompt("Ingrese el nuevo nombre");t&&(await this.viewModel.rename(e,t),this.view.clear(),this.view.render(this.viewModel))},this.view.onLastNameClick=async e=>{const t=prompt("Ingrese el nuevo apellido");t&&(await this.viewModel.renameLastName(e,t),this.view.clear(),this.view.render(this.viewModel))}}bindButtonAction(){this.view.onButtonClick=async()=>{await this.addStudent(),this.view.clear(),this.view.render(this.viewModel)},this.view.onDeleteClick=async e=>{await this.viewModel.deleteStudent(e),this.view.clear(),this.view.render(this.viewModel)},this.view.onReassignClick=async e=>{await this.openGroupsModal(e)}}show(){this.view.render(this.viewModel)}hide(){this.view.clear()}async update(){await this.viewModel.refreshData()}async addStudent(){const e=prompt("Ingrese el nombre")??"",t=prompt("Ingrese el apellido")??"",s=this.viewModel.getSelectedCourse();s&&(console.log(await this.viewModel.addStudent(s,e,t)),this.view.clear(),this.view.render(this.viewModel))}async openGroupsModal(e){const t=this.groups.map(([n,i])=>({id:n,name:i}));if(!this.viewModel.getSelectedCourse())return;const a=new u(t);a.open(async n=>{await this.viewModel.changeStudentGroup(e,n)||alert("No se pudo realizar esto"),this.view.clear(),a.close(),this.view.render(this.viewModel)})}}class L extends h{tableName="docente_materia_grupo";constructor(){super()}static async create(){const e=new this;return await e.reload(),e}async reload(){this.data=await this.fetchAll()}async fetchAll(){const e=new Map,{data:t,error:s}=await c.from("assignment_view").select("*");if(s)throw new Error(s.message);if(!t||t.length===0)return e;for(const a of t)a.id&&e.set(a.id,{teacherId:a.docente_id,teacherName:a.nombre_docente,teacherLastName:a.apellido_docente,subjectId:a.materia_id??"",subjectName:a.materia??"",groupId:a.grupo_id??"",groupName:a.grupo??""});return e}async delete(e){const{error:t}=await c.from(this.tableName).delete().eq("id",e);if(t)throw new Error(t.message);this.data.delete(e)}async insert(e){const{data:t,error:s}=await c.from(this.tableName).insert({grupo_id:e.groupId,materia_id:e.subjectId}).select().single();if(s)throw new Error(s.message);return await this.reload(),t.id}async updateAssignmentTeacher(e,t){const{error:s}=await c.from(this.tableName).update({docente_id:t}).eq("id",e);if(s)throw new Error(s.message);await this.reload()}}class T extends h{tableName="grupos";constructor(){super()}static async create(){const e=new this;return await e.reload(),e}async fetchAll(){const e=new Map,{data:t,error:s}=await c.from(this.tableName).select("*").order("nivel").order("nombre");if(s)throw new Error(s.message);if(!t||t.length===0)return e;for(const a of t)e.set(a.id,{name:a.nombre,grade:a.nivel,directorId:a.director_id});return e}async insert(e){const{data:t,error:s}=await c.from(this.tableName).insert({director_id:e.directorId,nivel:e.grade,nombre:e.name}).select("*").single();if(s)throw new Error(s.message);return this.data.set(t.id,e),t.id}}class x extends h{tableName="estudiantes";constructor(){super()}static async create(){const e=new this;return await e.reload(),e}async delete(e){const{data:t,error:s}=await c.from(this.tableName).update({activo:!1}).eq("id",e).select().single();if(s)throw new Error(s.message);t&&this.data.delete(t.id)}async fetchAll(){const e=new Map,{data:t,error:s}=await c.from(this.tableName).select("*").eq("activo",!0).order("apellido").order("nombre");if(s)throw new Error(s.message);if(!t||t.length===0)return e;for(const a of t)e.set(a.id,{name:a.nombre,lastName:a.apellido,active:a.activo??!1,groupId:a.grupo_id});return e}async insert(e){const{data:t,error:s}=await c.from(this.tableName).insert({nombre:e.name,apellido:e.lastName,activo:e.active,grupo_id:e.groupId}).select("id").single();if(s)throw new Error(s.message);if(!t)throw new Error("Couldnt retrieve id");return this.data.set(t.id,e),t.id}async updateName(e,t){const{data:s,error:a}=await c.from(this.tableName).update({nombre:t}).eq("id",e).select().single();if(a)throw new Error(a.message);return s&&this.data.set(s.id,this.rowMapper(s)),s!=null}async updateLastName(e,t){const{data:s,error:a}=await c.from(this.tableName).update({apellido:t}).eq("id",e).select().single();if(a)throw new Error(a.message);return s&&this.data.set(s.id,this.rowMapper(s)),s!=null}async updateGroup(e,t){const{data:s,error:a}=await c.from(this.tableName).update({grupo_id:t}).eq("id",e).select().single();if(a)throw new Error(a.message);return s&&this.data.set(s.id,this.rowMapper(s)),s!=null}rowMapper(e){return{name:e.nombre,lastName:e.apellido,active:e.activo??!1,groupId:e.grupo_id}}}class D{constructor(e){this.service=e}selectedCourseId;getAssignments(){return this.service.getAll()}async refreshData(){await this.service.reload()}setSelectedCourse(e){this.selectedCourseId=e}getSelectedCourse(){return this.selectedCourseId}async assignTeacher(e,t){await this.service.updateAssignmentTeacher(e,t)}async createAssignment(e,t){return await this.service.insert({groupId:e,subjectId:t})}}class _{constructor(e){this.service=e}selectedCourseId;getStudents(){return this.service.getAll()}async refreshData(){await this.service.reload()}setSelectedCourse(e){this.selectedCourseId=e}getSelectedCourse(){return this.selectedCourseId}async changeStudentGroup(e,t){return await this.service.updateGroup(e,t)}async addStudent(e,t,s){return await this.service.insert({name:t,lastName:s,groupId:e,active:!0})}async rename(e,t){return await this.service.updateName(e,t)}async renameLastName(e,t){return await this.service.updateLastName(e,t)}async deleteStudent(e){return await this.service.delete(e)}}const p=document.getElementsByTagName("header").item(0);if(!p)throw new Error("No header in this document");const q=new g;p.appendChild(q.render());const j=await T.create(),f=j.getAll().entries().toArray().map(([r,e])=>[r,e.name]),R=await L.create(),G=new D(R);new k(G,f);const V=await x.create(),F=new _(V);new I(F,f);document.body.style.opacity="1";
